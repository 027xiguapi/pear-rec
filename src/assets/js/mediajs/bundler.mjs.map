{"mappings":"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;Q,C,a,S,S,C,E,C,E;Y,E,S,G;Q,K,S,C,E,C,E;Y,I,I,K,E,I,O,S,C,c,C,I,C,G,I,C,C,E,G,C,C,E;Q;Q,O,c,G;I;I,O,S,C,E,C,E;Q,I,O,M,c,M,I,E,M,I,U,yB,O,K,iC;Q,c,G;Q,S,K;Y,I,C,W,G;Q;Q,E,S,G,M,I,G,O,M,C,K,C,G,S,G,E,S,E,I,I,A,C;I;A;A,I,iC,a,U,Q,I,W;I,iC,O,M,I,S,C,E;Q,I,I,G,I,G,I,U,M,E,I,G,I;Y,I,S,C,E;Y,I,I,K,E,I,O,S,C,c,C,I,C,G,I,C,C,E,G,C,C,E;Q;Q,O;I;I,O,+B,K,C,I,E;A;A,I,kC,a,U,S,I,S,O,E,U,E,C,E,S,E;I,S,M,K,E;Q,O,iB,I,Q,I,E,S,O,E;Y,Q;Q,E;I;I,O,I,C,K,C,I,O,C,E,S,O,E,M,E;Q,S,U,K,E;Y,I;gB,K,U,I,C;Y,E,O,G;gB,O;Y;Q;Q,S,S,K,E;Y,I;gB,K,S,C,Q,C;Y,E,O,G;gB,O;Y;Q;Q,S,K,M,E;Y,O,I,G,Q,O,K,I,M,O,K,E,I,C,W,S;Q;Q,K,A,C,Y,U,K,C,S,c,E,C,E,I;I;A;A,I,oC,a,U,W,I,S,O,E,I,E;I,I,I;Q,O;Q,M,W;Y,I,C,C,E,G,G,M,C,C,E,C;Y,O,C,C,E;Q;Q,M,E;Q,K,E;I,G,G,G,G;I,O,I;Q,M,K;Q,S,K;Q,U,K;I,G,O,W,c,C,C,C,O,Q,C,G,W;Q,O,I;I,C,G,C;I,S,K,C,E;Q,O,S,C,E;Y,O,K;gB;gB;a;Q;I;I,S,K,E,E;Q,I,G,M,I,U,mC;Q,M,K,C,I,G,E,C,E,I,C,I,C,C,A,G,C,C,I;Y,I,I,G,K,C,I,E,C,E,G,I,C,C,S,G,E,C,E,G,C,C,Q,I,C,A,C,I,C,C,S,A,K,E,I,C,I,C,A,I,E,I,A,K,C,A,C,I,E,I,C,G,E,C,E,C,E,I,E,O;Y,I,I,G,C,E,K;gB,E,C,E,G;gB,E,K;a;Y,O,E,C,E;gB,K;gB,K;oB,I;oB,K;gB,K;oB,E,K;oB,O;wB,O,E,C,E;wB,M,K;oB;gB,K;oB,E,K;oB,I,E,C,E;oB,K;wB;qB;oB,Q;gB,K;oB,K,E,G,C,G;oB,E,I,C,G;oB,Q;gB;oB,I,C,C,I,E,I,E,I,E,M,G,K,C,C,E,M,G,E,A,K,C,E,C,E,K,K,E,C,E,K,C,G;wB,I;wB,Q;oB,C;oB,I,E,C,E,K,K,C,C,K,E,C,E,G,C,C,E,I,E,C,E,G,C,C,E,G;wB,E,K,G,E,C,E;wB,K;oB,C;oB,I,E,C,E,K,K,E,K,G,C,C,E,E;wB,E,K,G,C,C,E;wB,I;wB,K;oB,C;oB,I,K,E,K,G,C,C,E,E;wB,E,K,G,C,C,E;wB,E,G,C,I,C;wB,K;oB,C;oB,I,C,C,E,E,E,G,C,G;oB,E,I,C,G;oB,Q;Y;Y,K,K,I,C,S;Q,E,O,G;Y,K;gB;gB;a;Y,I;Q,S;Y,I,I;Q;Q,I,E,C,E,G,G,M,E,C,E,C;Q,O;Y,O,E,C,E,G,E,C,E,G,K,C;Y,M,I;Q;I;A;AHKxB,IAAA,4CAAA,WAAA,GAAA,SAAA,MAAA,EAAA;IAAoB,gCAAA,OAAA;IAmBnB,SAAA,MACC,SAAoB,EACpB,MAAiD,EAFlD;QAAA,IAAA,UAIC,OAAA,IAAA,CAAA,IAAA,KAAO,IAAA;QAtBA,QAAA,WAAW,GAAuB,IAAI;QAEtC,QAAA,aAAa,GAAyB,IAAI;QAE1C,QAAA,UAAU,GAAW,EAAE;QAEvB,QAAA,UAAU,GAAsB,IAAI;QAEpC,QAAA,UAAU,GAAe;QAEzB,QAAA,sBAAsB,GAAkC,IAAI;QAE5D,QAAA,oBAAoB,GAAgC,IAAI;QAIxD,QAAA,SAAS,GAAkB,IAAI;QAOtC,IAAI,CAAA,GAAA,yCAAA,EAAI,sBAAsB,IAC7B,QAAK,YAAY,CAAC,WAAW,SAAS,CAAC;aAEvC,QAAK,IAAI,CAAC,SAAS;YAAE,MAAM;YAAe,SAAS,GAAA,MAAA,CAAG,CAAA,GAAA,yCAAA,EAAI,QAAQ;QAAI;Q,O;IAExE;IAEA,MAAA,SAAA,CAAA,SAAS,GAAT,SAAU,MAAiD,EAA3D;QACC,OAAQ,IAAI,CAAC,SAAS;YACrB,KAAK;gBACJ,IAAI,CAAC,cAAc,CAAC;gBACpB,KAAM;YAEP,KAAK;gBACJ,IAAI,CAAC,cAAc,CAAC;gBACpB,KAAM;YAEP,KAAK;gBACJ,IAAI,CAAC,eAAe,CAAC;gBACrB,KAAM;QACP;QAED,OAAO,IAAI;IACZ;IAEA,MAAA,SA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","sources":["src/exports.ts","src/media.ts","src/eventTarget.ts","src/soundMeter.ts","src/env.ts"],"sourcesContent":["import { Media } from \"./media\";\r\nimport type { AudioOption, VideoOption, ScreenOption } from \"./type\";\r\n\r\nfunction audio(option?: AudioOption) {\r\n\tconst audio = new Media(\"audio\", option);\r\n\r\n\treturn audio;\r\n}\r\n\r\nfunction video(option?: VideoOption) {\r\n\tconst video = new Media(\"video\", option);\r\n\treturn video;\r\n}\r\n\r\nfunction screen(option?: ScreenOption) {\r\n\tconst screen = new Media(\"screen\", option);\r\n\treturn screen;\r\n}\r\n\r\nexport { audio, video, screen };\r\nexport default Media;\r\n","import EventTarget from \"./eventTarget\";\r\nimport SoundMeter from \"./soundMeter\";\r\nimport { Env } from \"./env\";\r\nimport type {\r\n\tMediaType,\r\n\tMediaState,\r\n\tAudioOption,\r\n\tVideoOption,\r\n\tScreenOption,\r\n} from \"./type\";\r\n\r\nclass Media extends EventTarget {\r\n\tprivate mediaStream: MediaStream | null = null;\r\n\r\n\tprivate mediaRecorder: MediaRecorder | null = null;\r\n\r\n\tprivate mediaBlobs: Blob[] = [];\r\n\r\n\tprivate soundMeter: SoundMeter | null = null;\r\n\r\n\tprivate mediaState: MediaState = \"inactive\";\r\n\r\n\tprivate mediaStreamConstraints: MediaStreamConstraints | null = null;\r\n\r\n\tprivate mediaRecorderOptions: MediaRecorderOptions | null = null;\r\n\r\n\tprivate mediaType: MediaType;\r\n\r\n\tprivate timeSlice: number | null = null;\r\n\r\n\tconstructor(\r\n\t\tmediaType: MediaType,\r\n\t\toption?: AudioOption | VideoOption | ScreenOption,\r\n\t) {\r\n\t\tsuper();\r\n\t\tif (Env.isUnifiedPlanSupported()) {\r\n\t\t\tthis.setMediaType(mediaType).setConfig(option);\r\n\t\t} else {\r\n\t\t\tthis.emit(\"error\", { type: \"constructor\", message: `${Env.toString()}` });\r\n\t\t}\r\n\t}\r\n\r\n\tsetConfig(option?: AudioOption | VideoOption | ScreenOption) {\r\n\t\tswitch (this.mediaType) {\r\n\t\t\tcase \"audio\":\r\n\t\t\t\tthis.setAudioConfig(option);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"video\":\r\n\t\t\t\tthis.setVideoConfig(option);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"screen\":\r\n\t\t\t\tthis.setScreenConfig(option);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetAudioConstraints(option) {\r\n\t\tlet { audio, sampleRate, echoCancellation } = option || {};\r\n\r\n\t\tif (\r\n\t\t\ttypeof sampleRate === \"undefined\" &&\r\n\t\t\ttypeof echoCancellation === \"undefined\"\r\n\t\t) {\r\n\t\t\taudio || (audio = true);\r\n\t\t} else {\r\n\t\t\taudio = {};\r\n\t\t\tsampleRate && (audio[\"sampleRate\"] = sampleRate);\r\n\t\t\techoCancellation &&\r\n\t\t\t\t(audio[\"echoCancellation\"] = { exact: echoCancellation });\r\n\t\t}\r\n\r\n\t\treturn audio;\r\n\t}\r\n\r\n\tgetVideoConstraints(option) {\r\n\t\tlet { video, sampleRate, width, height } = option || {};\r\n\r\n\t\tif (\r\n\t\t\ttypeof sampleRate === \"undefined\" &&\r\n\t\t\ttypeof width === \"undefined\" &&\r\n\t\t\ttypeof height === \"undefined\"\r\n\t\t) {\r\n\t\t\tvideo || (video = true);\r\n\t\t} else {\r\n\t\t\tvideo = {};\r\n\t\t\tsampleRate && (video[\"sampleRate\"] = sampleRate);\r\n\t\t\twidth && (video[\"width\"] = width);\r\n\t\t\theight && (video[\"height\"] = height);\r\n\t\t}\r\n\r\n\t\treturn video;\r\n\t}\r\n\r\n\tgetConfigOptions(option) {\r\n\t\tlet { mimeType, audioBitsPerSecond, videoBitsPerSecond } = option || {};\r\n\t\tlet options = {\r\n\t\t\tmimeType: mimeType || this.getSupportedMimeTypes()?.[0],\r\n\t\t};\r\n\t\taudioBitsPerSecond && (options[\"audioBitsPerSecond\"] = audioBitsPerSecond);\r\n\t\tvideoBitsPerSecond && (options[\"videoBitsPerSecond\"] = videoBitsPerSecond);\r\n\r\n\t\treturn options;\r\n\t}\r\n\r\n\tsetAudioConfig(option: AudioOption) {\r\n\t\tlet audio = this.getAudioConstraints(option);\r\n\t\tlet options = this.getConfigOptions(option);\r\n\r\n\t\tthis.setMediaStreamConstraints({ audio })\r\n\t\t\t.setMediaRecorderOptions(options)\r\n\t\t\t.setTimeSlice(option?.timeSlice);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetVideoConfig(option: VideoOption) {\r\n\t\tlet audio = this.getAudioConstraints(option);\r\n\t\tlet video = this.getVideoConstraints(option);\r\n\t\tlet options = this.getConfigOptions(option);\r\n\r\n\t\tthis.setMediaStreamConstraints({ video, audio })\r\n\t\t\t.setMediaRecorderOptions(options)\r\n\t\t\t.setTimeSlice(option?.timeSlice);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetScreenConfig(option: ScreenOption) {\r\n\t\tlet audio = this.getAudioConstraints(option);\r\n\t\tlet video = this.getVideoConstraints(option);\r\n\t\tlet options = this.getConfigOptions(option);\r\n\r\n\t\tthis.setMediaStreamConstraints({ video, audio })\r\n\t\t\t.setMediaRecorderOptions(options)\r\n\t\t\t.setTimeSlice(option?.timeSlice);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetTimeSlice(timeSlice: number) {\r\n\t\ttimeSlice && (this.timeSlice = timeSlice);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetTimeSlice() {\r\n\t\treturn this.timeSlice;\r\n\t}\r\n\r\n\tgetMediaType() {\r\n\t\treturn this.mediaType;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param setMediaType \r\n\t * audio: 录音 Boolean;\r\n\t\tvideo: 录像 Boolean;\r\n\t\tscreen: 录屏 Boolean;\r\n\t * @returns \r\n\t */\r\n\tsetMediaType(mediaType: MediaType) {\r\n\t\tthis.mediaType = mediaType;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetMedisStream(): MediaStream | null {\r\n\t\treturn this.mediaStream;\r\n\t}\r\n\r\n\tasync setMediaStream(constraints?: MediaStreamConstraints) {\r\n\t\tthis.setMediaStreamConstraints(constraints);\r\n\t\tconst _constraints = this.getMediaStreamConstraints();\r\n\t\tconst mediaType = this.getMediaType();\r\n\t\tthis.setMediaState(\"wait\");\r\n\t\ttry {\r\n\t\t\tthis.mediaStream =\r\n\t\t\t\tmediaType === \"screen\"\r\n\t\t\t\t\t? await navigator.mediaDevices.getDisplayMedia(_constraints)\r\n\t\t\t\t\t: await navigator.mediaDevices.getUserMedia(_constraints);\r\n\t\t\tthis.setMediaState(\"ready\");\r\n\t\t\tthis.setSoundMeter();\r\n\t\t\treturn this;\r\n\t\t} catch (err) {\r\n\t\t\tthis.setMediaState(\"inactive\");\r\n\t\t\tthis.emit(\"error\", { type: \"setMedisStream\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tgetMediaRecorder(): MediaRecorder | null {\r\n\t\treturn this.mediaRecorder;\r\n\t}\r\n\r\n\tsetMediaRecorder(options?: MediaRecorderOptions) {\r\n\t\tthis.setMediaRecorderOptions(options);\r\n\t\tthis.mediaRecorder = new MediaRecorder(\r\n\t\t\tthis.mediaStream,\r\n\t\t\tthis.getMediaRecorderOptions(),\r\n\t\t);\r\n\r\n\t\tthis.mediaRecorder.onerror = (err: any) => {\r\n\t\t\tthis.emit(\"error\", { type: \"mediaRecorder\", message: err });\r\n\t\t};\r\n\r\n\t\t// 将 stream 转成 blob 来存放\r\n\t\tthis.mediaRecorder.ondataavailable = (blobEvent: BlobEvent) => {\r\n\t\t\tthis.emit(\"dataavailable\", blobEvent);\r\n\t\t\tthis.mediaBlobs.push(blobEvent.data);\r\n\t\t};\r\n\r\n\t\tthis.mediaRecorder.onstart = (event: any) => {\r\n\t\t\tthis.mediaBlobs = [];\r\n\t\t\tthis.emit(\"start\", event);\r\n\t\t};\r\n\r\n\t\tthis.mediaRecorder.onstop = (event: any) => {\r\n\t\t\tthis.soundMeter.stop();\r\n\t\t\tthis.emit(\"stop\", event);\r\n\t\t};\r\n\r\n\t\tthis.mediaRecorder.onpause = (event: any) => {\r\n\t\t\tthis.emit(\"pause\", event);\r\n\t\t};\r\n\r\n\t\tthis.mediaRecorder.onresume = (event: any) => {\r\n\t\t\tthis.emit(\"resume\", event);\r\n\t\t};\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetMediaBlobs(): Blob[] {\r\n\t\treturn this.mediaBlobs;\r\n\t}\r\n\r\n\tgetMediaState(): MediaState {\r\n\t\treturn this.mediaState;\r\n\t}\r\n\r\n\tprivate setMediaState(mediaState: MediaState) {\r\n\t\tthis.mediaState = mediaState;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// type RecordingState = \"inactive\" | \"paused\" | \"recording\";\r\n\tgetRecorderState(): string {\r\n\t\treturn this.getMediaRecorder()?.state || \"inactive\";\r\n\t}\r\n\r\n\tgetMediaStreamConstraints(): MediaStreamConstraints | null {\r\n\t\treturn this.mediaStreamConstraints;\r\n\t}\r\n\r\n\t/**\r\n     *  \r\n     * @param constraints \r\n     * audio：指定是否获取音频流。\r\n        video：指定是否获取视频流。\r\n        audioConstraints 和 videoConstraints：分别指定音频和视频的约束条件，例如采样率、帧速率等。\r\n        facingMode：指定使用前置或后置摄像头。\r\n        width 和 height：指定视频的宽度和高度。\r\n        frameRate：指定视频的帧速率。\r\n        deviceId：指定要使用的音频或视频设备的 ID。\r\n     * @returns \r\n     */\r\n\tsetMediaStreamConstraints(constraints?: MediaStreamConstraints) {\r\n\t\tconst _constraints = {\r\n\t\t\t...this.getMediaStreamConstraints(),\r\n\t\t\t...constraints,\r\n\t\t};\r\n\t\tthis.mediaStreamConstraints = _constraints;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetMediaRecorderOptions(): MediaRecorderOptions | null {\r\n\t\treturn this.mediaRecorderOptions;\r\n\t}\r\n\r\n\t/**\r\n     * \r\n     * @param options \r\n     * mimeType：指定录制的媒体文件类型，例如 audio/webm、video/webm 等。\r\n        audioBitsPerSecond 和 videoBitsPerSecond：分别指定音频和视频的比特率。\r\n        audioChannels：指定使用的音频通道数。\r\n        videoFrameRate：指定视频的帧速率。\r\n        width 和 height：指定视频的宽度和高度。\r\n        videoSize：指定视频的大小，可以是宽度和高度组成的对象，也可以是字符串（例如“640x480”）。\r\n        echoCancellation：指定是否启用回声消除。\r\n     * @returns \r\n     */\r\n\tsetMediaRecorderOptions(options?: MediaRecorderOptions) {\r\n\t\tconst _options = { ...this.getMediaRecorderOptions(), ...options };\r\n\t\tthis.mediaRecorderOptions = _options;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisReady(type: string = \"isReady\"): boolean {\r\n\t\tconst mediaState = this.getMediaState();\r\n\t\tif (mediaState === \"ready\") {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\tconst err = `the cureent mediaState is ${mediaState}, Please use open function`;\r\n\t\t\tthis.emit(\"error\", { type, message: err });\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tonerror(callback?: Function) {\r\n\t\tcallback && this.on(\"error\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 创建\r\n\tasync create() {\r\n\t\tif (this.getMediaState() === \"inactive\") {\r\n\t\t\tconst media = await this.setMediaStream();\r\n\t\t\tif (media) {\r\n\t\t\t\tthis.setMediaRecorder();\r\n\t\t\t\tthis.emit(\"create\");\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t} else {\r\n\t\t\tthis.emit(\"error\", {\r\n\t\t\t\ttype: \"create\",\r\n\t\t\t\tmessage: `mediaState: ${this.getMediaState()}`,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\toncreate(callback?: Function) {\r\n\t\tcallback && this.on(\"create\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 销毁\r\n\tdestroy() {\r\n\t\tif (this.getMediaState() !== \"inactive\") {\r\n\t\t\tthis.getRecorderState() !== \"inactive\" && this.stop();\r\n\t\t\tthis.mediaStream?.getTracks().forEach((track) => track.stop());\r\n\t\t\tthis.mediaBlobs = [];\r\n\t\t\tthis.mediaStream = null;\r\n\t\t\tthis.mediaRecorder = null;\r\n\t\t\tthis.setMediaState(\"inactive\");\r\n\t\t\tthis.emit(\"destroy\");\r\n\t\t\treturn this;\r\n\t\t} else {\r\n\t\t\tthis.emit(\"error\", {\r\n\t\t\t\ttype: \"destroy\",\r\n\t\t\t\tmessage: `mediaState: ${this.getMediaState()}`,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tondestroy(callback?: Function) {\r\n\t\tcallback && this.on(\"destroy\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tondataavailable(callback?: Function) {\r\n\t\tcallback && this.on(\"dataavailable\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 开始\r\n\tstart(timeSlice?: number) {\r\n\t\tif (!this.isReady()) return this;\r\n\t\ttry {\r\n\t\t\tthis.setTimeSlice(timeSlice);\r\n\t\t\ttimeSlice = this.getTimeSlice();\r\n\t\t\ttimeSlice\r\n\t\t\t\t? this.mediaRecorder?.start(timeSlice)\r\n\t\t\t\t: this.mediaRecorder?.start();\r\n\t\t\treturn this;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"start\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tonstart(callback?: Function) {\r\n\t\tcallback && this.on(\"start\", callback);\r\n\t}\r\n\r\n\tstop() {\r\n\t\tif (!this.isReady()) return this;\r\n\t\ttry {\r\n\t\t\tthis.mediaRecorder?.stop();\r\n\t\t\treturn this;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"stop\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tonstop(callback?: Function) {\r\n\t\tcallback && this.on(\"stop\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 暂停\r\n\tpause() {\r\n\t\tif (!this.isReady()) return this;\r\n\t\ttry {\r\n\t\t\tthis.mediaRecorder?.pause();\r\n\t\t\treturn this;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"pause\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tonpause(callback?: Function) {\r\n\t\tcallback && this.on(\"pause\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 继续\r\n\tresume() {\r\n\t\tif (!this.isReady()) return this;\r\n\t\ttry {\r\n\t\t\tthis.mediaRecorder?.resume();\r\n\t\t\treturn this;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"resume\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tonresume(callback?: Function) {\r\n\t\tcallback && this.on(\"resume\", callback);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetSoundMeter(mediaStream?: MediaStream) {\r\n\t\ttry {\r\n\t\t\tconst audioContext = new AudioContext();\r\n\t\t\tthis.soundMeter = new SoundMeter(audioContext);\r\n\t\t\tthis.soundMeter.connectToSource(mediaStream || this.mediaStream);\r\n\t\t\treturn this;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"setSoundMeter\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tgetSoundMeter(): SoundMeter {\r\n\t\treturn this.soundMeter;\r\n\t}\r\n\r\n\tgetBlob(options?: BlobPropertyBag): Blob {\r\n\t\tif (!this.isReady()) return;\r\n\t\tconst { mimeType } = this.getMediaRecorderOptions();\r\n\t\tif (!options) {\r\n\t\t\toptions = {\r\n\t\t\t\ttype: mimeType,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst blob = new Blob(this.mediaBlobs, options);\r\n\t\treturn blob;\r\n\t}\r\n\r\n\t// 获取BlobUrl\r\n\tgetBlobUrl(options?: BlobPropertyBag): string {\r\n\t\tif (!this.isReady()) return;\r\n\t\ttry {\r\n\t\t\tconst blob = this.getBlob(options);\r\n\t\t\tconst mediaUrl = URL.createObjectURL(blob);\r\n\t\t\treturn mediaUrl;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"getBlobUrl\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tdownloadBlob(filename) {\r\n\t\tconst url = this.getBlobUrl();\r\n\t\tconst a = document.createElement(\"a\");\r\n\t\ta.style.display = \"none\";\r\n\t\ta.href = url;\r\n\t\ta.download = `${filename || \"mediajs\"}.webm`;\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.click();\r\n\t\tsetTimeout(() => {\r\n\t\t\tdocument.body.removeChild(a);\r\n\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t}, 150);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 获取时长\r\n\tgetDuration(blob?: Blob): Promise<number> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tblob = blob || this.getBlob();\r\n\r\n\t\t\tconst _this = this;\r\n\t\t\tconst audioContext = new AudioContext();\r\n\t\t\tconst reader = new FileReader();\r\n\r\n\t\t\treader.onload = function () {\r\n\t\t\t\tconst arrayBuffer = this.result as ArrayBuffer;\r\n\t\t\t\taudioContext.decodeAudioData(\r\n\t\t\t\t\tarrayBuffer,\r\n\t\t\t\t\t(buffer) => {\r\n\t\t\t\t\t\tconst duration = Math.round(buffer.duration * 1000);\r\n\t\t\t\t\t\tresolve(duration);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t(err) => {\r\n\t\t\t\t\t\t_this.emit(\"error\", \"getDuration\", `getDuration function is err`);\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t};\r\n\r\n\t\t\tif (blob) {\r\n\t\t\t\treader.readAsArrayBuffer(blob);\r\n\t\t\t} else {\r\n\t\t\t\t_this.emit(\"error\", \"getDuration\", `blob is Empty`);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tasync _enumerateDevices() {\r\n\t\ttry {\r\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\r\n\t\t\treturn devices;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", { type: \"_enumerateDevices\", message: err });\r\n\t\t}\r\n\t}\r\n\r\n\tgetSupportedMimeTypes(): string[] {\r\n\t\tconst media = this.mediaType === \"audio\" ? \"audio\" : \"video\";\r\n\t\tconst types = [\r\n\t\t\t\"webm\",\r\n\t\t\t\"mp4\",\r\n\t\t\t\"ogg\",\r\n\t\t\t\"mov\",\r\n\t\t\t\"avi\",\r\n\t\t\t\"wmv\",\r\n\t\t\t\"flv\",\r\n\t\t\t\"mkv\",\r\n\t\t\t\"ts\",\r\n\t\t\t\"x-matroska\",\r\n\t\t];\r\n\t\tconst codecs = [\r\n\t\t\t\"vp9\",\r\n\t\t\t\"vp9.0\",\r\n\t\t\t\"vp8\",\r\n\t\t\t\"vp8.0\",\r\n\t\t\t\"avc1\",\r\n\t\t\t\"av1\",\r\n\t\t\t\"h265\",\r\n\t\t\t\"h264\",\r\n\t\t];\r\n\t\tconst supported: string[] = [];\r\n\t\tconst isSupported = MediaRecorder.isTypeSupported;\r\n\t\ttypes.forEach((type: string) => {\r\n\t\t\tconst mimeType = `${media}/${type}`;\r\n\t\t\tcodecs.forEach((codec: string) =>\r\n\t\t\t\t[\r\n\t\t\t\t\t`${mimeType};codecs=${codec}`,\r\n\t\t\t\t\t`${mimeType};codecs=${codec.toUpperCase()}`,\r\n\t\t\t\t].forEach((variation) => {\r\n\t\t\t\t\tif (isSupported(variation)) supported.push(variation);\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\t\t\tif (isSupported(mimeType)) supported.push(mimeType);\r\n\t\t});\r\n\t\treturn supported;\r\n\t}\r\n\r\n\t_isTypeSupported(mimeType: string): boolean {\r\n\t\treturn MediaRecorder.isTypeSupported(mimeType);\r\n\t}\r\n\r\n\tgetVideoTracks(stream?: MediaStream): MediaStreamTrack[] {\r\n\t\tstream = stream || this.mediaStream;\r\n\t\treturn stream.getVideoTracks();\r\n\t}\r\n\r\n\tconnectVideo(video: HTMLVideoElement) {\r\n\t\tvideo.srcObject = this.mediaStream;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tconnectAudio(audio: HTMLAudioElement) {\r\n\t\taudio.srcObject = this.mediaStream;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsnapshot(canvas: HTMLCanvasElement, video: HTMLVideoElement) {\r\n\t\tcanvas.width = video.videoWidth;\r\n\t\tcanvas.height = video.videoHeight;\r\n\t\tcanvas.getContext(\"2d\").drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport { Media };\r\n\r\nexport default Media;\r\n","type EventType =\r\n\t| \"error\"\r\n\t| \"create\"\r\n\t| \"destroy\"\r\n\t| \"start\"\r\n\t| \"stop\"\r\n\t| \"pause\"\r\n\t| \"resume\"\r\n\t| \"dataavailable\";\r\n\r\nclass EventTarget {\r\n\tprivate eventBus: Record<EventType, Function[]> = {\r\n\t\terror: [],\r\n\t\tcreate: [],\r\n\t\tdestroy: [],\r\n\t\tstart: [],\r\n\t\tstop: [],\r\n\t\tpause: [],\r\n\t\tresume: [],\r\n\t\tdataavailable: [],\r\n\t};\r\n\r\n\t// 注册\r\n\ton(name: EventType, callback: Function) {\r\n\t\tconst callbackList: Array<Function> = this.eventBus[name] || [];\r\n\t\tcallbackList.push(callback);\r\n\t\tthis.eventBus[name] = callbackList;\r\n\t}\r\n\r\n\t// 触发\r\n\temit(name: EventType, ...args: Array<any>) {\r\n\t\tconst evnetName = this.eventBus[name];\r\n\t\tif (evnetName) {\r\n\t\t\tevnetName.forEach((fn) => {\r\n\t\t\t\tfn.apply(this, args);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole.error(`emit ${name} is not find`);\r\n\t\t}\r\n\t}\r\n\r\n\t// 删除\r\n\toff(name: EventType, fn: Function) {\r\n\t\tconst evnetName = this.eventBus[name];\r\n\t\tif (evnetName && fn) {\r\n\t\t\tconst index = evnetName.findIndex((fns) => fns === fn);\r\n\t\t\tevnetName.splice(index, 1);\r\n\t\t} else {\r\n\t\t\tconsole.error(`off ${name} is not find`);\r\n\t\t}\r\n\t}\r\n\r\n\t// 注册一次\r\n\tonce(name: EventType, fn: Function) {\r\n\t\tconst decor = (...args: Array<any>) => {\r\n\t\t\tfn.apply(this, args);\r\n\t\t\tthis.off(name, decor);\r\n\t\t};\r\n\t\tthis.on(name, decor);\r\n\t}\r\n}\r\n\r\nexport default EventTarget;\r\n","class SoundMeter {\r\n\tprivate context: AudioContext;\r\n\tprivate instant: number = 0.0;\r\n\tprivate slow: number = 0.0;\r\n\tprivate clip: number = 0.0;\r\n\tprivate script: ScriptProcessorNode;\r\n\tprivate mic: MediaStreamAudioSourceNode;\r\n\r\n\tconstructor(context: AudioContext) {\r\n\t\tthis.context = context;\r\n\t\tthis.script = context.createScriptProcessor(2048, 1, 1);\r\n\t\tthis.script.onaudioprocess = (event) => {\r\n\t\t\tconst input = event.inputBuffer.getChannelData(0);\r\n\t\t\tlet i;\r\n\t\t\tlet sum = 0.0;\r\n\t\t\tlet clipcount = 0;\r\n\t\t\tfor (i = 0; i < input.length; ++i) {\r\n\t\t\t\tsum += input[i] * input[i];\r\n\t\t\t\tif (Math.abs(input[i]) > 0.99) {\r\n\t\t\t\t\tclipcount += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.instant = Math.sqrt(sum / input.length);\r\n\t\t\tthis.slow = 0.95 * this.slow + 0.05 * this.instant;\r\n\t\t\tthis.clip = clipcount / input.length;\r\n\t\t};\r\n\t}\r\n\r\n\tgetInstant() {\r\n\t\treturn this.instant;\r\n\t}\r\n\r\n\tgetSlow() {\r\n\t\treturn this.slow;\r\n\t}\r\n\r\n\tgetClip() {\r\n\t\treturn this.clip;\r\n\t}\r\n\r\n\tconnectToSource(stream: MediaStream) {\r\n\t\ttry {\r\n\t\t\tthis.mic = this.context.createMediaStreamSource(stream);\r\n\t\t\tthis.mic.connect(this.script);\r\n\t\t\tthis.script.connect(this.context.destination);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis.mic.disconnect();\r\n\t\tthis.script.disconnect();\r\n\t}\r\n}\r\n\r\nexport { SoundMeter };\r\n\r\nexport default SoundMeter;\r\n","import webRTCAdapter_import from \"webrtc-adapter\";\r\n\r\nconst webRTCAdapter: typeof webRTCAdapter_import =\r\n\t//@ts-ignore\r\n\twebRTCAdapter_import.default || webRTCAdapter_import;\r\n\r\nexport const Env = new (class {\r\n\treadonly isIOS = [\"iPad\", \"iPhone\", \"iPod\"].includes(navigator.platform);\r\n\treadonly supportedBrowsers = [\"firefox\", \"chrome\", \"safari\"];\r\n\r\n\treadonly minFirefoxVersion = 59;\r\n\treadonly minChromeVersion = 72;\r\n\treadonly minSafariVersion = 605;\r\n\r\n\tisAudioContextSupported(): boolean {\r\n\t\treturn typeof AudioContext !== \"undefined\";\r\n\t}\r\n\r\n\tisMediaDevicesSupported(): boolean {\r\n\t\treturn typeof navigator.mediaDevices !== \"undefined\";\r\n\t}\r\n\r\n\tisGetUserMediaSupported(): boolean {\r\n\t\treturn (\r\n\t\t\tthis.isMediaDevicesSupported() &&\r\n\t\t\ttypeof navigator.mediaDevices.getUserMedia !== \"undefined\"\r\n\t\t);\r\n\t}\r\n\r\n\tisMediaRecorderSupported(): boolean {\r\n\t\treturn typeof MediaRecorder !== \"undefined\";\r\n\t}\r\n\r\n\tisAudioWorkletNode(): boolean {\r\n\t\treturn typeof AudioWorkletNode !== \"undefined\";\r\n\t}\r\n\r\n\tisBrowserSupported(): boolean {\r\n\t\tconst browser = this.getBrowser();\r\n\t\tconst version = this.getVersion();\r\n\r\n\t\tconst validBrowser = this.supportedBrowsers.includes(browser);\r\n\r\n\t\tif (!validBrowser) return false;\r\n\r\n\t\tif (browser === \"chrome\") return version >= this.minChromeVersion;\r\n\t\tif (browser === \"firefox\") return version >= this.minFirefoxVersion;\r\n\t\tif (browser === \"safari\")\r\n\t\t\treturn !this.isIOS && version >= this.minSafariVersion;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetBrowser(): string {\r\n\t\treturn webRTCAdapter.browserDetails.browser;\r\n\t}\r\n\r\n\tgetVersion(): number {\r\n\t\treturn webRTCAdapter.browserDetails.version || 0;\r\n\t}\r\n\r\n\tisUnifiedPlanSupported(): boolean {\r\n\t\tconst browser = this.getBrowser();\r\n\t\tconst version = webRTCAdapter.browserDetails.version || 0;\r\n\r\n\t\tif (browser === \"chrome\" && version < this.minChromeVersion) return false;\r\n\t\tif (browser === \"firefox\" && version >= this.minFirefoxVersion) return true;\r\n\t\tif (\r\n\t\t\t!(\r\n\t\t\t\tthis.isAudioContextSupported() &&\r\n\t\t\t\tthis.isMediaDevicesSupported() &&\r\n\t\t\t\tthis.isGetUserMediaSupported() &&\r\n\t\t\t\tthis.isMediaRecorderSupported() &&\r\n\t\t\t\tthis.isAudioWorkletNode()\r\n\t\t\t)\r\n\t\t)\r\n\t\t\treturn false;\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\ttoString(): string {\r\n\t\treturn `Supports:\r\n    browser:${this.getBrowser()}\r\n    version:${this.getVersion()}\r\n    isIOS:${this.isIOS}\r\n    isAudioContextSupported:${this.isAudioContextSupported()}\r\n\tisMediaDevicesSupported:${this.isMediaDevicesSupported()}\r\n\tisGetUserMediaSupported:${this.isGetUserMediaSupported()}\r\n\tisMediaRecorderSupported:${this.isMediaRecorderSupported()}\r\n    isBrowserSupported:${this.isBrowserSupported()}\r\n\tisAudioWorkletNode:${this.isAudioWorkletNode()}\r\n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}\r\n\t`;\r\n\t}\r\n})();\r\n"],"names":[],"version":3,"file":"bundler.mjs.map"}