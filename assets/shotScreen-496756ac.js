import{C as fe,r as l,a as ve,c as ee,i as _e,j as ye}from"./main-63cdee0e.js";var we={exports:{}},te={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge;function Be(){if(ge)return te;ge=1;var e=fe,t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,c=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function n(a,p,o){var u,h={},d=null,f=null;o!==void 0&&(d=""+o),p.key!==void 0&&(d=""+p.key),p.ref!==void 0&&(f=p.ref);for(u in p)s.call(p,u)&&!r.hasOwnProperty(u)&&(h[u]=p[u]);if(a&&a.defaultProps)for(u in p=a.defaultProps,p)h[u]===void 0&&(h[u]=p[u]);return{$$typeof:t,type:a,key:d,ref:f,props:h,_owner:c.current}}return te.Fragment=i,te.jsx=n,te.jsxs=n,te}we.exports=Be();var g=we.exports,B=(e=>(e[e.Edit=0]="Edit",e[e.Source=1]="Source",e))(B||{});function ae({image:e,width:t,height:i,history:s,bounds:c}){return new Promise((r,n)=>{const a=document.createElement("canvas"),p=c.width*window.devicePixelRatio,o=c.height*window.devicePixelRatio;a.width=p,a.height=o;const u=a.getContext("2d");if(!u)return n(new Error("convert image to blob fail"));const h=e.naturalWidth/t,d=e.naturalHeight/i;u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="low",u.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0),u.clearRect(0,0,c.width,c.height),u.drawImage(e,c.x*h,c.y*d,c.width*h,c.height*d,0,0,c.width,c.height),s.stack.slice(0,s.index+1).forEach(f=>{f.type===B.Source&&f.draw(u,f)}),a.toBlob(f=>{if(!f)return n(new Error("canvas toBlob fail"));r(f)},"image/png")})}const be={magnifier_position_label:"坐标",operation_ok_title:"确定",operation_cancel_title:"取消",operation_save_title:"保存",operation_redo_title:"重做",operation_undo_title:"撤销",operation_mosaic_title:"马赛克",operation_text_title:"文本",operation_brush_title:"画笔",operation_arrow_title:"箭头",operation_ellipse_title:"椭圆",operation_rectangle_title:"矩形"},pe=fe.createContext({store:{url:void 0,image:null,width:0,height:0,lang:be,emiterRef:{current:{}},canvasContextRef:{current:null},history:{index:-1,stack:[]},bounds:null,cursor:"move",operation:void 0},dispatcher:{call:void 0,setHistory:void 0,setBounds:void 0,setCursor:void 0,setOperation:void 0}});function ne(){const{dispatcher:e}=l.useContext(pe);return e}function H(){const{store:e}=l.useContext(pe);return e}function V(){const{bounds:e}=H(),{setBounds:t}=ne(),i=l.useCallback(c=>{t==null||t(c)},[t]),s=l.useCallback(()=>{t==null||t(null)},[t]);return[e,{set:i,reset:s}]}function I(){const{lang:e}=H();return e}const W=100,U=80,Me=l.memo(function({x:e,y:t}){const{width:i,height:s,image:c}=H(),r=I(),[n,a]=l.useState(null),p=l.useRef(null),o=l.useRef(null),u=l.useRef(null),[h,d]=l.useState("000000");return l.useLayoutEffect(()=>{if(!p.current)return;const f=p.current.getBoundingClientRect();let x=e+20,v=t+20;x+f.width>i&&(x=e-f.width-20),v+f.height>s&&(v=t-f.height-20),x<0&&(x=0),v<0&&(v=0),a({x,y:v})},[i,s,e,t]),l.useEffect(()=>{if(!c||!o.current){u.current=null;return}if(u.current||(u.current=o.current.getContext("2d")),!u.current)return;const f=u.current;f.clearRect(0,0,W,U);const x=c.naturalWidth/i,v=c.naturalHeight/s;f.drawImage(c,e*x-W/2,t*v-U/2,W,U,0,0,W,U);const{data:w}=f.getImageData(Math.floor(W/2),Math.floor(U/2),1,1),R=Array.from(w.slice(0,3)).map(C=>C>=16?C.toString(16):`0${C.toString(16)}`).join("").toUpperCase();d(R)},[i,s,c,e,t]),g.jsxs("div",{ref:p,className:"screenshots-magnifier",style:{transform:`translate(${n==null?void 0:n.x}px, ${n==null?void 0:n.y}px)`},children:[g.jsx("div",{className:"screenshots-magnifier-body",children:g.jsx("canvas",{ref:o,className:"screenshots-magnifier-body-canvas",width:W,height:U})}),g.jsxs("div",{className:"screenshots-magnifier-footer",children:[g.jsxs("div",{className:"screenshots-magnifier-footer-item",children:[r.magnifier_position_label,": (",e,",",t,")"]}),g.jsxs("div",{className:"screenshots-magnifier-footer-item",children:["RGB: #",h]})]})]})});function Te({x:e,y:t},{x:i,y:s},c,r){return e>i&&([e,i]=[i,e]),t>s&&([t,s]=[s,t]),e<0&&(e=0),i>c&&(i=c),t<0&&(t=0),s>r&&(s=r),{x:e,y:t,width:i-e,height:s-t}}const Le=l.memo(function(){const{url:e,image:t,width:i,height:s}=H(),[c,r]=V(),n=l.useRef(null),a=l.useRef(null),p=l.useRef(!1),[o,u]=l.useState(null),h=l.useCallback((f,x)=>{if(!n.current)return;const{x:v,y:w}=n.current.getBoundingClientRect();r.set(Te({x:f.x-v,y:f.y-w},{x:x.x-v,y:x.y-w},i,s))},[i,s,r]),d=l.useCallback(f=>{a.current||c||f.button!==0||(a.current={x:f.clientX,y:f.clientY},p.current=!1)},[c]);return l.useEffect(()=>{const f=v=>{if(n.current){const w=n.current.getBoundingClientRect();v.clientX<w.left||v.clientY<w.top||v.clientX>w.right||v.clientY>w.bottom?u(null):u({x:v.clientX-w.x,y:v.clientY-w.y})}a.current&&(h(a.current,{x:v.clientX,y:v.clientY}),p.current=!0)},x=v=>{a.current&&(p.current&&h(a.current,{x:v.clientX,y:v.clientY}),a.current=null,p.current=!1)};return window.addEventListener("mousemove",f),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",x)}},[h]),l.useLayoutEffect(()=>{(!t||c)&&u(null)},[t,c]),!e||!t?null:g.jsxs("div",{ref:n,className:"screenshots-background",onMouseDown:d,children:[g.jsx("img",{className:"screenshots-background-image",src:e}),g.jsx("div",{className:"screenshots-background-mask"}),o&&!c&&g.jsx(Me,{x:o==null?void 0:o.x,y:o==null?void 0:o.y})]})});function $(){const{cursor:e}=H(),{setCursor:t}=ne(),i=l.useCallback(c=>{t==null||t(c)},[t]),s=l.useCallback(()=>{t==null||t("move")},[t]);return[e,{set:i,reset:s}]}function J(){const{emiterRef:e}=H(),t=l.useCallback((r,n)=>{const a=e.current;Array.isArray(a[r])?a[r].push(n):a[r]=[n]},[e]),i=l.useCallback((r,n)=>{const a=e.current;if(Array.isArray(a[r])){const p=a[r].findIndex(o=>o===n);p!==-1&&a[r].splice(p,1)}},[e]),s=l.useCallback((r,...n)=>{const a=e.current;Array.isArray(a[r])&&a[r].forEach(p=>p(...n))},[e]),c=l.useCallback(()=>{e.current={}},[e]);return{on:t,off:i,emit:s,reset:c}}function P(){const{history:e}=H(),{setHistory:t}=ne(),i=l.useCallback(u=>{const{index:h,stack:d}=e;d.forEach(f=>{f.type===B.Source&&(f.isSelected=!1)}),u.type===B.Source?u.isSelected=!0:u.type===B.Edit&&(u.source.isSelected=!0),d.splice(h+1),d.push(u),t==null||t({index:d.length-1,stack:d})},[e,t]),s=l.useCallback(()=>{const{stack:u}=e;u.pop(),t==null||t({index:u.length-1,stack:u})},[e,t]),c=l.useCallback(()=>{const{index:u,stack:h}=e,d=h[u];d&&(d.type===B.Source?d.isSelected=!1:d.type===B.Edit&&d.source.editHistory.pop()),t==null||t({index:u<=0?-1:u-1,stack:h})},[e,t]),r=l.useCallback(()=>{const{index:u,stack:h}=e,d=h[u+1];d&&(d.type===B.Source?d.isSelected=!1:d.type===B.Edit&&d.source.editHistory.push(d)),t==null||t({index:u>=h.length-1?h.length-1:u+1,stack:h})},[e,t]),n=l.useCallback(u=>{t==null||t({...u})},[t]),a=l.useCallback(u=>{e.stack.forEach(h=>{h.type===B.Source&&(h===u?h.isSelected=!0:h.isSelected=!1)}),t==null||t({...e})},[e,t]),p=l.useCallback(()=>{e.stack.forEach(u=>{u.type===B.Source&&(u.isSelected=!1)}),t==null||t({...e})},[e,t]),o=l.useCallback(()=>{t==null||t({index:-1,stack:[]})},[t]);return[{index:e.index,stack:e.stack,top:e.stack.slice(e.index,e.index+1)[0]},{push:i,pop:s,undo:c,redo:r,set:n,select:a,clearSelect:p,reset:o}]}function D(){const{operation:e}=H(),{setOperation:t}=ne(),i=l.useCallback(c=>{t==null||t(c)},[t]),s=l.useCallback(()=>{t==null||t(void 0)},[t]);return[e,{set:i,reset:s}]}function He({x:e,y:t},{x:i,y:s},c,r,n,a){return e>i&&([e,i]=[i,e]),t>s&&([t,s]=[s,t]),e<0&&(e=0,a==="move"&&(i=c.width)),i>r&&(i=r,a==="move"&&(e=i-c.width)),t<0&&(t=0,a==="move"&&(s=c.height)),s>n&&(s=n,a==="move"&&(t=s-c.height)),{x:e,y:t,width:Math.max(i-e,1),height:Math.max(s-t,1)}}function Ne(e,t,i,s){const c=e.clientX-i.x,r=e.clientY-i.y;let n=s.x,a=s.y,p=s.x+s.width,o=s.y+s.height;switch(t){case"top":a+=r;break;case"top-right":p+=c,a+=r;break;case"right":p+=c;break;case"right-bottom":p+=c,o+=r;break;case"bottom":o+=r;break;case"bottom-left":n+=c,o+=r;break;case"left":n+=c;break;case"left-top":n+=c,a+=r;break;case"move":n+=c,a+=r,p+=c,o+=r;break}return[{x:n,y:a},{x:p,y:o}]}function Pe(e,t,i,s){if(!t)return!1;const c=document.createElement("canvas");c.width=e.width,c.height=e.height;const r=c.getContext("2d");if(!r)return!1;const{left:n,top:a}=t.getBoundingClientRect(),p=s.clientX-n,o=s.clientY-a;return[...i.stack.slice(0,i.index+1)].reverse().find(u=>{var h;return u.type!==B.Source?!1:(r.clearRect(0,0,e.width,e.height),(h=u.isHit)==null?void 0:h.call(u,r,u,{x:p,y:o}))})}const Xe=["top","right","bottom","left"],Ye=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"],Ae=l.memo(l.forwardRef(function(e,t){const{url:i,image:s,width:c,height:r}=H(),n=J(),[a]=P(),[p]=$(),[o,u]=V(),[h]=D(),d=l.useRef(),f=l.useRef(null),x=l.useRef(null),v=l.useRef(null),w=l.useRef(null),R=o&&!a.stack.length&&!h,C=l.useCallback(()=>{if(!o||!w.current)return;const m=w.current;m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="low",m.clearRect(0,0,o.width,o.height),a.stack.slice(0,a.index+1).forEach(b=>{b.type===B.Source&&b.draw(m,b)})},[o,w,a]),z=l.useCallback((m,b)=>{if(!(m.button!==0||!o))if(!h)d.current=b,f.current={x:m.clientX,y:m.clientY},x.current={x:o.x,y:o.y,width:o.width,height:o.height};else{const k=Pe(o,v.current,a,m.nativeEvent);k?n.emit("drawselect",k,m.nativeEvent):n.emit("mousedown",m.nativeEvent)}},[o,h,n,a]),y=l.useCallback(m=>{if(!d.current||!f.current||!x.current||!o)return;const b=Ne(m,d.current,f.current,x.current);u.set(He(b[0],b[1],o,c,r,d.current))},[c,r,o,u]);return l.useLayoutEffect(()=>{if(!s||!o||!v.current){w.current=null;return}w.current||(w.current=v.current.getContext("2d")),C()},[s,o,C]),l.useEffect(()=>{const m=k=>{if(h)n.emit("mousemove",k);else{if(!d.current||!f.current||!x.current)return;y(k)}},b=k=>{if(h)n.emit("mouseup",k);else{if(!d.current||!f.current||!x.current)return;y(k),d.current=void 0,f.current=null,x.current=null}};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",b),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",b)}},[y,h,n]),l.useImperativeHandle(t,()=>w.current),g.jsxs("div",{className:"screenshots-canvas",style:{width:(o==null?void 0:o.width)||0,height:(o==null?void 0:o.height)||0,transform:o?`translate(${o.x}px, ${o.y}px)`:"none"},children:[g.jsxs("div",{className:"screenshots-canvas-body",children:[g.jsx("img",{className:"screenshots-canvas-image",src:i,style:{width:c,height:r,transform:o?`translate(${-o.x}px, ${-o.y}px)`:"none"}}),g.jsx("canvas",{ref:v,className:"screenshots-canvas-panel",width:(o==null?void 0:o.width)||0,height:(o==null?void 0:o.height)||0})]}),g.jsx("div",{className:"screenshots-canvas-mask",style:{cursor:p},onMouseDown:m=>z(m,"move"),children:R&&g.jsxs("div",{className:"screenshots-canvas-size",children:[o.width," × ",o.height]})}),Xe.map(m=>g.jsx("div",{className:`screenshots-canvas-border-${m}`},m)),R&&Ye.map(m=>g.jsx("div",{className:`screenshots-canvas-point-${m}`,onMouseDown:b=>z(b,m)},m))]})}));function me(){const e=ne();return l.useCallback((t,...i)=>{var s;(s=e.call)==null||s.call(e,t,...i)},[e])}function F(){const{canvasContextRef:e}=H();return e}function xe(){const e=J(),[,t]=V(),[,i]=$(),[,s]=P(),[,c]=D();return l.useCallback(()=>{e.reset(),s.reset(),t.reset(),i.reset(),c.reset()},[e,s,t,i,c])}const Ie=l.memo(function({open:e,content:t,children:i}){const s=l.useRef(null),c=l.useRef(null),r=l.useRef(null),n=l.useContext(ze),[a,p]=l.useState("bottom"),[o,u]=l.useState(null),[h,d]=l.useState(0),f=()=>(c.current||(c.current=document.createElement("div")),c.current);return l.useEffect(()=>{const x=f();return e&&document.body.appendChild(x),()=>{x.remove()}},[e]),l.useEffect(()=>{if(!e||!n||!s.current||!r.current)return;const x=s.current.getBoundingClientRect(),v=r.current.getBoundingClientRect();let w=a,R=x.left+x.width/2,C=x.top+x.height,z=h;if(R+v.width/2>n.x+n.width){const y=R;R=n.x+n.width-v.width/2,z=y-R}if(R<n.x+v.width/2){const y=R;R=n.x+v.width/2,z=y-R}C>window.innerHeight-v.height&&(w==="bottom"&&(w="top"),C=x.top-v.height),C<0&&(w==="top"&&(w="bottom"),C=x.top+x.height),w!==a&&p(w),((o==null?void 0:o.x)!==R||o.y!==C)&&u({x:R,y:C}),z!==h&&d(z)}),g.jsxs(g.Fragment,{children:[l.cloneElement(i,{ref:s}),e&&t&&ve.createPortal(g.jsxs("div",{ref:r,className:"screenshots-option",style:{visibility:o?"visible":"hidden",transform:`translate(${(o==null?void 0:o.x)??0}px, ${(o==null?void 0:o.y)??0}px)`},"data-placement":a,children:[g.jsx("div",{className:"screenshots-option-container",children:t}),g.jsx("div",{className:"screenshots-option-arrow",style:{marginLeft:h}})]}),f())]})}),X=l.memo(function({title:e,icon:t,checked:i,disabled:s,option:c,onClick:r}){const n=["screenshots-button"],a=l.useCallback(p=>{s||!r||r(p)},[s,r]);return i&&n.push("screenshots-button-checked"),s&&n.push("screenshots-button-disabled"),g.jsx(Ie,{open:i,content:c,children:g.jsx("div",{className:n.join(" "),title:e,onClick:a,children:g.jsx("span",{className:t})})})});function Oe(){const{image:e,width:t,height:i,history:s,bounds:c,lang:r}=H(),n=F(),[,a]=P(),p=me(),o=xe(),u=l.useCallback(()=>{a.clearSelect(),setTimeout(()=>{!n.current||!e||!c||ae({image:e,width:t,height:i,history:s,bounds:c}).then(h=>{p("onOk",h,c),o()})})},[n,a,e,t,i,s,c,p,o]);return g.jsx(X,{title:r.operation_ok_title,icon:"icon-ok",onClick:u})}function $e(){const e=me(),t=xe(),i=I(),s=l.useCallback(()=>{e("onCancel"),t()},[e,t]);return g.jsx(X,{title:i.operation_cancel_title,icon:"icon-cancel",onClick:s})}function De(){const{image:e,width:t,height:i,history:s,bounds:c,lang:r}=H(),n=F(),[,a]=P(),p=me(),o=xe(),u=l.useCallback(()=>{a.clearSelect(),setTimeout(()=>{!n.current||!e||!c||ae({image:e,width:t,height:i,history:s,bounds:c}).then(h=>{p("onSave",h,c),o()})})},[n,a,e,t,i,s,c,p,o]);return g.jsx(X,{title:r.operation_save_title,icon:"icon-save",onClick:u})}function Fe(){const e=I(),[t,i]=P(),s=l.useCallback(()=>{i.redo()},[i]);return g.jsx(X,{title:e.operation_redo_title,icon:"icon-redo",disabled:!t.stack.length||t.stack.length-1===t.index,onClick:s})}function We(){const e=I(),[t,i]=P(),s=l.useCallback(()=>{i.undo()},[i]);return g.jsx(X,{title:e.operation_undo_title,icon:"icon-undo",disabled:t.index===-1,onClick:s})}const Ce=l.memo(function({value:e,onChange:t}){const i=[3,6,9];return g.jsx("div",{className:"screenshots-size",children:i.map(s=>{const c=["screenshots-size-item"];return s===e&&c.push("screenshots-size-active"),g.jsx("div",{className:c.join(" "),onClick:()=>t&&t(s),children:g.jsx("div",{className:"screenshots-size-pointer",style:{width:s*1.8,height:s*1.8}})},s)})})});function G(e){const t=J();l.useEffect(()=>(t.on("mousedown",e),()=>{t.off("mousedown",e)}),[e,t])}function q(e){const t=J();l.useEffect(()=>(t.on("mousemove",e),()=>{t.off("mousemove",e)}),[e,t])}function Q(e){const t=J();l.useEffect(()=>(t.on("mouseup",e),()=>{t.off("mouseup",e)}),[e,t])}function ce(e,t,i){if(!i)return[0,0,0,0];const{data:s,width:c}=i,r=t*c*4+e*4;return Array.from(s.slice(r,r+4))}function Ue(e,t){const{tiles:i,size:s}=t.data;i.forEach(c=>{const r=Math.round(c.color[0]),n=Math.round(c.color[1]),a=Math.round(c.color[2]),p=c.color[3]/255;e.fillStyle=`rgba(${r}, ${n}, ${a}, ${p})`,e.fillRect(c.x-s/2,c.y-s/2,s,s)})}function Ve(){const e=I(),{image:t,width:i,height:s}=H(),[c,r]=D(),n=F(),[a,p]=P(),[o]=V(),[,u]=$(),[h,d]=l.useState(3),f=l.useRef(null),x=l.useRef(null),v=c==="Mosaic",w=l.useCallback(()=>{r.set("Mosaic"),u.set("crosshair")},[r,u]),R=l.useCallback(()=>{v||(w(),p.clearSelect())},[v,w,p]),C=l.useCallback(m=>{if(!v||x.current||!f.current||!n.current)return;const b=n.current.canvas.getBoundingClientRect(),k=m.clientX-b.x,S=m.clientY-b.y,j=h*2;x.current={name:"Mosaic",type:B.Source,data:{size:j,tiles:[{x:k,y:S,color:ce(k,S,f.current)}]},editHistory:[],draw:Ue}},[v,h,n]),z=l.useCallback(m=>{if(!v||!x.current||!n.current||!f.current)return;const b=n.current.canvas.getBoundingClientRect(),k=m.clientX-b.x,S=m.clientY-b.y,j=x.current.data.size,_=x.current.data.tiles;let E=_[_.length-1];if(!E)_.push({x:k,y:S,color:ce(k,S,f.current)});else{const ie=E.x-k,M=E.y-S;let N=Math.sqrt(ie**2+M**2);const ue=-M/N,de=-ie/N;for(;N>j;){const K=Math.floor(E.x+j*de),Z=Math.floor(E.y+j*ue);E={x:K,y:Z,color:ce(K,Z,f.current)},_.push(E),N-=j}N>j/2&&_.push({x:k,y:S,color:ce(k,S,f.current)})}a.top!==x.current?p.push(x.current):p.set(a)},[v,n,a,p]),y=l.useCallback(()=>{v&&(x.current=null)},[v]);return G(C),q(z),Q(y),l.useEffect(()=>{if(!o||!t||!v)return;const m=document.createElement("canvas"),b=m.getContext("2d");if(!b)return;m.width=o.width,m.height=o.height;const k=t.naturalWidth/i,S=t.naturalHeight/s;b.drawImage(t,o.x*k,o.y*S,o.width*k,o.height*S,0,0,o.width,o.height),f.current=b.getImageData(0,0,o.width,o.height)},[i,s,o,t,v]),g.jsx(X,{title:e.operation_mosaic_title,icon:"icon-mosaic",checked:v,onClick:R,option:g.jsx(Ce,{value:h,onChange:d})})}const Je=l.memo(function({value:e,onChange:t}){const i=["#ee5126","#fceb4d","#90e746","#51c0fa","#7a7a7a","#ffffff"];return g.jsx("div",{className:"screenshots-color",children:i.map(s=>{const c=["screenshots-color-item"];return s===e&&c.push("screenshots-color-active"),g.jsx("div",{className:c.join(" "),style:{backgroundColor:s},onClick:()=>t&&t(s)},s)})})}),re=l.memo(function({size:e,color:t,onSizeChange:i,onColorChange:s}){return g.jsxs("div",{className:"screenshots-sizecolor",children:[g.jsx(Ce,{value:e,onChange:i}),g.jsx(Je,{value:t,onChange:s})]})}),Ge=`
min-width: 0 !important;
width: 0 !important;
min-height: 0 !important;
height:0 !important;
visibility: hidden !important;
overflow: hidden !important;
position: absolute !important;
z-index: -1000 !important;
top:0 !important;
right:0 !important;
`,qe=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","text-indent","padding-left","padding-right","border-width","box-sizing","white-space","word-break"];let O;function Qe(e){const t=window.getComputedStyle(e),i=t.getPropertyValue("box-sizing")||t.getPropertyValue("-moz-box-sizing")||t.getPropertyValue("-webkit-box-sizing"),s=parseFloat(t.getPropertyValue("padding-bottom"))+parseFloat(t.getPropertyValue("padding-top")),c=parseFloat(t.getPropertyValue("border-bottom-width"))+parseFloat(t.getPropertyValue("border-top-width"));return{sizingStyle:qe.map(r=>`${r}:${t.getPropertyValue(r)}`).join(";"),paddingSize:s,borderSize:c,boxSizing:i}}function Ke(e,t,i,s){O||(O=document.createElement("textarea"),O.setAttribute("tab-index","-1"),document.body.appendChild(O));const{paddingSize:c,borderSize:r,boxSizing:n,sizingStyle:a}=Qe(e);O.setAttribute("style",`${a};${Ge};max-width:${i}px;max-height:${s}px`),O.value=t||" ";let p=O.scrollWidth,o=O.scrollHeight;return n==="border-box"?(p+=r,o+=r):n==="content-box"&&(p-=c,o-=c),{width:Math.min(p,i),height:Math.min(o,s)}}const Ze=l.memo(function({x:e,y:t,maxWidth:i,maxHeight:s,size:c,color:r,value:n,onChange:a,onBlur:p}){const o=l.useRef(null),u=l.useRef(null),[h,d]=l.useState(0),[f,x]=l.useState(0),v=()=>(o.current||(o.current=document.createElement("div")),o.current);return l.useLayoutEffect(()=>(o.current&&(document.body.appendChild(o.current),requestAnimationFrame(()=>{var w;(w=u.current)==null||w.focus()})),()=>{var w;(w=o.current)==null||w.remove()}),[]),l.useLayoutEffect(()=>{if(!u.current)return;const{width:w,height:R}=Ke(u.current,n,i,s);d(w),x(R)},[n,i,s]),ve.createPortal(g.jsx("textarea",{ref:u,className:"screenshots-textarea",style:{color:r,width:h,height:f,maxWidth:i,maxHeight:s,fontSize:c,lineHeight:`${c}px`,transform:`translate(${e}px, ${t}px)`},value:n,onChange:w=>a&&a(w.target.value),onBlur:w=>p&&p(w)}),v())});function oe(e){const t=J();l.useEffect(()=>(t.on("drawselect",e),()=>{t.off("drawselect",e)}),[e,t])}const he={3:18,6:32,9:46};function et(e,t){const{size:i,color:s,fontFamily:c,x:r,y:n,text:a}=t.data;e.fillStyle=s,e.textAlign="left",e.textBaseline="top",e.font=`${i}px ${c}`;const p=t.editHistory.reduce((o,{data:u})=>({x:o.x+u.x2-u.x1,y:o.y+u.y2-u.y1}),{x:0,y:0});a.split(`
`).forEach((o,u)=>{e.fillText(o,r+p.x,n+p.y+u*i)})}function tt(e,t,i){e.textAlign="left",e.textBaseline="top",e.font=`${t.data.size}px ${t.data.fontFamily}`;let s=0,c=0;t.data.text.split(`
`).forEach(h=>{const d=e.measureText(h);s<d.width&&(s=d.width),c+=t.data.size});const{x:r,y:n}=t.editHistory.reduce((h,{data:d})=>({x:h.x+d.x2-d.x1,y:h.y+d.y2-d.y1}),{x:0,y:0}),a=t.data.x+r,p=t.data.y+n,o=a+s,u=p+c;return i.x>=a&&i.x<=o&&i.y>=p&&i.y<=u}function nt(){const e=I(),[t,i]=P(),[s]=V(),[c,r]=D(),[,n]=$(),a=F(),[p,o]=l.useState(3),[u,h]=l.useState("#ee5126"),d=l.useRef(null),f=l.useRef(null),[x,v]=l.useState(null),[w,R]=l.useState(""),C=c==="Text",z=l.useCallback(()=>{r.set("Text"),n.set("default")},[r,n]),y=l.useCallback(()=>{C||(z(),i.clearSelect())},[C,z,i]),m=l.useCallback(M=>{d.current&&(d.current.data.size=he[M]),o(M)},[]),b=l.useCallback(M=>{d.current&&(d.current.data.color=M),h(M)},[]),k=l.useCallback(M=>{R(M),C&&d.current&&(d.current.data.text=M)},[C]),S=l.useCallback(()=>{d.current&&d.current.data.text&&i.push(d.current),d.current=null,R(""),v(null)},[i]),j=l.useCallback((M,N)=>{M.name==="Text"&&(z(),f.current={type:B.Edit,data:{x1:N.clientX,y1:N.clientY,x2:N.clientX,y2:N.clientY},source:M},i.select(M))},[z,i]),_=l.useCallback(M=>{if(!C||!a.current||d.current||!s)return;const{left:N,top:ue}=a.current.canvas.getBoundingClientRect(),de=window.getComputedStyle(a.current.canvas).fontFamily,K=M.clientX-N,Z=M.clientY-ue;d.current={name:"Text",type:B.Source,data:{size:he[p],color:u,fontFamily:de,x:K,y:Z,text:""},editHistory:[],draw:et,isHit:tt},v({x:M.clientX,y:M.clientY,maxWidth:s.width-K,maxHeight:s.height-Z})},[C,p,u,s,a]),E=l.useCallback(M=>{C&&f.current&&(f.current.data.x2=M.clientX,f.current.data.y2=M.clientY,t.top!==f.current?(f.current.source.editHistory.push(f.current),i.push(f.current)):i.set(t))},[C,t,i]),ie=l.useCallback(()=>{C&&(f.current=null)},[C]);return oe(j),G(_),q(E),Q(ie),g.jsxs(g.Fragment,{children:[g.jsx(X,{title:e.operation_text_title,icon:"icon-text",checked:C,onClick:y,option:g.jsx(re,{size:p,color:u,onSizeChange:m,onColorChange:b})}),C&&x&&g.jsx(Ze,{x:x.x,y:x.y,maxWidth:x.maxWidth,maxHeight:x.maxHeight,size:he[p],color:u,value:w,onChange:k,onBlur:S})]})}const ke=4;function T(e,t,i){e.lineWidth=1,e.strokeStyle="#000000",e.fillStyle="#ffffff",e.beginPath(),e.arc(t,i,ke,0,2*Math.PI),e.fill(),e.stroke()}function le(e,t,i){t.draw(e,t);const{data:s}=e.getImageData(i.x,i.y,1,1);return s.some(c=>c!==0)}function L(e,t,i){if(!e)return!1;const{left:s,top:c}=e.getBoundingClientRect(),r=t.clientX-s,n=t.clientY-c;return(i.x-r)**2+(i.y-n)**2<ke**2}function rt(e,t){const{size:i,color:s,points:c}=t.data;e.lineCap="round",e.lineJoin="round",e.lineWidth=i,e.strokeStyle=s;const r=t.editHistory.reduce((n,{data:a})=>({x:n.x+a.x2-a.x1,y:n.y+a.y2-a.y1}),{x:0,y:0});e.beginPath(),c.forEach((n,a)=>{a===0?e.moveTo(n.x+r.x,n.y+r.y):e.lineTo(n.x+r.x,n.y+r.y)}),e.stroke(),t.isSelected&&(e.lineWidth=1,e.strokeStyle="#000000",e.beginPath(),c.forEach((n,a)=>{a===0?e.moveTo(n.x+r.x,n.y+r.y):e.lineTo(n.x+r.x,n.y+r.y)}),e.stroke())}function ot(){const e=I(),[,t]=$(),[i,s]=D(),c=F(),[r,n]=P(),[a,p]=l.useState(3),[o,u]=l.useState("#ee5126"),h=l.useRef(null),d=l.useRef(null),f=i==="Brush",x=l.useCallback(()=>{s.set("Brush"),t.set("default")},[s,t]),v=l.useCallback(()=>{f||(x(),n.clearSelect())},[f,x,n]),w=l.useCallback((y,m)=>{y.name==="Brush"&&(x(),d.current={type:B.Edit,data:{x1:m.clientX,y1:m.clientY,x2:m.clientX,y2:m.clientY},source:y},n.select(y))},[x,n]),R=l.useCallback(y=>{if(!f||h.current||!c.current)return;const{left:m,top:b}=c.current.canvas.getBoundingClientRect();h.current={name:"Brush",type:B.Source,data:{size:a,color:o,points:[{x:y.clientX-m,y:y.clientY-b}]},editHistory:[],draw:rt,isHit:le}},[f,c,a,o]),C=l.useCallback(y=>{if(!(!f||!c.current)){if(d.current)d.current.data.x2=y.clientX,d.current.data.y2=y.clientY,r.top!==d.current?(d.current.source.editHistory.push(d.current),n.push(d.current)):n.set(r);else if(h.current){const{left:m,top:b}=c.current.canvas.getBoundingClientRect();h.current.data.points.push({x:y.clientX-m,y:y.clientY-b}),r.top!==h.current?n.push(h.current):n.set(r)}}},[f,r,c,n]),z=l.useCallback(()=>{f&&(h.current&&n.clearSelect(),h.current=null,d.current=null)},[f,n]);return oe(w),G(R),q(C),Q(z),g.jsx(X,{title:e.operation_brush_title,icon:"icon-brush",checked:f,onClick:v,option:g.jsx(re,{size:a,color:o,onSizeChange:p,onColorChange:u})})}function Se(e){let{x1:t,y1:i,x2:s,y2:c}=e.data;return e.editHistory.forEach(({data:r})=>{const n=r.x2-r.x1,a=r.y2-r.y1;r.type===se.Move?(t+=n,i+=a,s+=n,c+=a):r.type===se.MoveStart?(t+=n,i+=a):r.type===se.MoveEnd&&(s+=n,c+=a)}),{...e.data,x1:t,x2:s,y1:i,y2:c}}function it(e,t){const{size:i,color:s,x1:c,x2:r,y1:n,y2:a}=Se(t);e.lineCap="round",e.lineJoin="bevel",e.lineWidth=i,e.strokeStyle=s;const p=r-c,o=a-n,u=i*3,h=Math.atan2(o,p);e.beginPath(),e.moveTo(c,n),e.lineTo(r,a),e.lineTo(r-u*Math.cos(h-Math.PI/6),a-u*Math.sin(h-Math.PI/6)),e.moveTo(r,a),e.lineTo(r-u*Math.cos(h+Math.PI/6),a-u*Math.sin(h+Math.PI/6)),e.stroke(),t.isSelected&&(T(e,c,n),T(e,r,a))}var se=(e=>(e[e.Move=0]="Move",e[e.MoveStart=1]="MoveStart",e[e.MoveEnd=2]="MoveEnd",e))(se||{});function ct(){const e=I(),[,t]=$(),[i,s]=D(),[c,r]=P(),n=F(),[a,p]=l.useState(3),[o,u]=l.useState("#ee5126"),h=l.useRef(null),d=l.useRef(null),f=i==="Arrow",x=l.useCallback(()=>{s.set("Arrow"),t.set("default")},[s,t]),v=l.useCallback(()=>{f||(x(),r.clearSelect())},[f,x,r]),w=l.useCallback((y,m)=>{if(y.name!=="Arrow"||!n.current)return;const b=y;x();const{x1:k,y1:S,x2:j,y2:_}=Se(b);let E=0;L(n.current.canvas,m,{x:k,y:S})?E=1:L(n.current.canvas,m,{x:j,y:_})&&(E=2),d.current={type:B.Edit,data:{type:E,x1:m.clientX,y1:m.clientY,x2:m.clientX,y2:m.clientY},source:b},r.select(y)},[n,x,r]),R=l.useCallback(y=>{if(!f||h.current||!n.current)return;const{left:m,top:b}=n.current.canvas.getBoundingClientRect();h.current={name:"Arrow",type:B.Source,data:{size:a,color:o,x1:y.clientX-m,y1:y.clientY-b,x2:y.clientX-m,y2:y.clientY-b},editHistory:[],draw:it,isHit:le}},[f,o,a,n]),C=l.useCallback(y=>{if(!(!f||!n.current)){if(d.current)d.current.data.x2=y.clientX,d.current.data.y2=y.clientY,c.top!==d.current?(d.current.source.editHistory.push(d.current),r.push(d.current)):r.set(c);else if(h.current){const{left:m,top:b}=n.current.canvas.getBoundingClientRect();h.current.data.x2=y.clientX-m,h.current.data.y2=y.clientY-b,c.top!==h.current?r.push(h.current):r.set(c)}}},[f,c,n,r]),z=l.useCallback(()=>{f&&(h.current&&r.clearSelect(),h.current=null,d.current=null)},[f,r]);return oe(w),G(R),q(C),Q(z),g.jsx(X,{title:e.operation_arrow_title,icon:"icon-arrow",checked:f,onClick:v,option:g.jsx(re,{size:a,color:o,onSizeChange:p,onColorChange:u})})}function Re(e){let{x1:t,y1:i,x2:s,y2:c}=e.data;return e.editHistory.forEach(({data:r})=>{const n=r.x2-r.x1,a=r.y2-r.y1;r.type===Y.Move?(t+=n,i+=a,s+=n,c+=a):r.type===Y.ResizeTop?i+=a:r.type===Y.ResizeRightTop?(s+=n,i+=a):r.type===Y.ResizeRight?s+=n:r.type===Y.ResizeRightBottom?(s+=n,c+=a):r.type===Y.ResizeBottom?c+=a:r.type===Y.ResizeLeftBottom?(t+=n,c+=a):r.type===Y.ResizeLeft?t+=n:r.type===Y.ResizeLeftTop&&(t+=n,i+=a)}),{...e.data,x1:t,x2:s,y1:i,y2:c}}function st(e,t){const{size:i,color:s,x1:c,y1:r,x2:n,y2:a}=Re(t);e.lineCap="butt",e.lineJoin="miter",e.lineWidth=i,e.strokeStyle=s;const p=(c+n)/2,o=(r+a)/2,u=Math.abs(n-c)/2,h=Math.abs(a-r)/2,d=.5522848,f=u*d,x=h*d;e.beginPath(),e.moveTo(p-u,o),e.bezierCurveTo(p-u,o-x,p-f,o-h,p,o-h),e.bezierCurveTo(p+f,o-h,p+u,o-x,p+u,o),e.bezierCurveTo(p+u,o+x,p+f,o+h,p,o+h),e.bezierCurveTo(p-f,o+h,p-u,o+x,p-u,o),e.closePath(),e.stroke(),t.isSelected&&(e.lineWidth=1,e.strokeStyle="#000000",e.fillStyle="#ffffff",e.beginPath(),e.moveTo(c,r),e.lineTo(n,r),e.lineTo(n,a),e.lineTo(c,a),e.closePath(),e.stroke(),T(e,(c+n)/2,r),T(e,n,r),T(e,n,(r+a)/2),T(e,n,a),T(e,(c+n)/2,a),T(e,c,a),T(e,c,(r+a)/2),T(e,c,r))}var Y=(e=>(e[e.Move=0]="Move",e[e.ResizeTop=1]="ResizeTop",e[e.ResizeRightTop=2]="ResizeRightTop",e[e.ResizeRight=3]="ResizeRight",e[e.ResizeRightBottom=4]="ResizeRightBottom",e[e.ResizeBottom=5]="ResizeBottom",e[e.ResizeLeftBottom=6]="ResizeLeftBottom",e[e.ResizeLeft=7]="ResizeLeft",e[e.ResizeLeftTop=8]="ResizeLeftTop",e))(Y||{});function at(){const e=I(),[t,i]=P(),[s,c]=D(),[,r]=$(),n=F(),[a,p]=l.useState(3),[o,u]=l.useState("#ee5126"),h=l.useRef(null),d=l.useRef(null),f=s==="Ellipse",x=l.useCallback(()=>{c.set("Ellipse"),r.set("crosshair")},[c,r]),v=l.useCallback(()=>{f||(x(),i.clearSelect())},[f,x,i]),w=l.useCallback((y,m)=>{if(y.name!=="Ellipse"||!n.current)return;const b=y;x();const{x1:k,y1:S,x2:j,y2:_}=Re(b);let E=0;L(n.current.canvas,m,{x:(k+j)/2,y:S})?E=1:L(n.current.canvas,m,{x:j,y:S})?E=2:L(n.current.canvas,m,{x:j,y:(S+_)/2})?E=3:L(n.current.canvas,m,{x:j,y:_})?E=4:L(n.current.canvas,m,{x:(k+j)/2,y:_})?E=5:L(n.current.canvas,m,{x:k,y:_})?E=6:L(n.current.canvas,m,{x:k,y:(S+_)/2})?E=7:L(n.current.canvas,m,{x:k,y:S})&&(E=8),d.current={type:B.Edit,data:{type:E,x1:m.clientX,y1:m.clientY,x2:m.clientX,y2:m.clientY},source:b},i.select(y)},[n,x,i]),R=l.useCallback(y=>{if(!f||!n.current||h.current)return;const{left:m,top:b}=n.current.canvas.getBoundingClientRect(),k=y.clientX-m,S=y.clientY-b;h.current={name:"Ellipse",type:B.Source,data:{size:a,color:o,x1:k,y1:S,x2:k,y2:S},editHistory:[],draw:st,isHit:le}},[f,a,o,n]),C=l.useCallback(y=>{if(!(!f||!n.current)){if(d.current)d.current.data.x2=y.clientX,d.current.data.y2=y.clientY,t.top!==d.current?(d.current.source.editHistory.push(d.current),i.push(d.current)):i.set(t);else if(h.current){const{left:m,top:b}=n.current.canvas.getBoundingClientRect();h.current.data.x2=y.clientX-m,h.current.data.y2=y.clientY-b,t.top!==h.current?i.push(h.current):i.set(t)}}},[f,n,t,i]),z=l.useCallback(()=>{f&&(h.current&&i.clearSelect(),h.current=null,d.current=null)},[f,i]);return oe(w),G(R),q(C),Q(z),g.jsx(X,{title:e.operation_ellipse_title,icon:"icon-ellipse",checked:f,onClick:v,option:g.jsx(re,{size:a,color:o,onSizeChange:p,onColorChange:u})})}function Ee(e){let{x1:t,y1:i,x2:s,y2:c}=e.data;return e.editHistory.forEach(({data:r})=>{const n=r.x2-r.x1,a=r.y2-r.y1;r.type===A.Move?(t+=n,i+=a,s+=n,c+=a):r.type===A.ResizeTop?i+=a:r.type===A.ResizeRightTop?(s+=n,i+=a):r.type===A.ResizeRight?s+=n:r.type===A.ResizeRightBottom?(s+=n,c+=a):r.type===A.ResizeBottom?c+=a:r.type===A.ResizeLeftBottom?(t+=n,c+=a):r.type===A.ResizeLeft?t+=n:r.type===A.ResizeLeftTop&&(t+=n,i+=a)}),{...e.data,x1:t,x2:s,y1:i,y2:c}}function lt(e,t){const{size:i,color:s,x1:c,y1:r,x2:n,y2:a}=Ee(t);e.lineCap="butt",e.lineJoin="miter",e.lineWidth=i,e.strokeStyle=s,e.beginPath(),e.moveTo(c,r),e.lineTo(n,r),e.lineTo(n,a),e.lineTo(c,a),e.closePath(),e.stroke(),t.isSelected&&(e.lineWidth=1,e.strokeStyle="#000000",e.fillStyle="#ffffff",T(e,(c+n)/2,r),T(e,n,r),T(e,n,(r+a)/2),T(e,n,a),T(e,(c+n)/2,a),T(e,c,a),T(e,c,(r+a)/2),T(e,c,r))}var A=(e=>(e[e.Move=0]="Move",e[e.ResizeTop=1]="ResizeTop",e[e.ResizeRightTop=2]="ResizeRightTop",e[e.ResizeRight=3]="ResizeRight",e[e.ResizeRightBottom=4]="ResizeRightBottom",e[e.ResizeBottom=5]="ResizeBottom",e[e.ResizeLeftBottom=6]="ResizeLeftBottom",e[e.ResizeLeft=7]="ResizeLeft",e[e.ResizeLeftTop=8]="ResizeLeftTop",e))(A||{});function ut(){const e=I(),[t,i]=P(),[s,c]=D(),[,r]=$(),n=F(),[a,p]=l.useState(3),[o,u]=l.useState("#ee5126"),h=l.useRef(null),d=l.useRef(null),f=s==="Rectangle",x=l.useCallback(()=>{c.set("Rectangle"),r.set("crosshair")},[c,r]),v=l.useCallback(()=>{f||(x(),i.clearSelect())},[f,x,i]),w=l.useCallback((y,m)=>{if(y.name!=="Rectangle"||!n.current)return;const b=y;x();const{x1:k,y1:S,x2:j,y2:_}=Ee(b);let E=0;L(n.current.canvas,m,{x:(k+j)/2,y:S})?E=1:L(n.current.canvas,m,{x:j,y:S})?E=2:L(n.current.canvas,m,{x:j,y:(S+_)/2})?E=3:L(n.current.canvas,m,{x:j,y:_})?E=4:L(n.current.canvas,m,{x:(k+j)/2,y:_})?E=5:L(n.current.canvas,m,{x:k,y:_})?E=6:L(n.current.canvas,m,{x:k,y:(S+_)/2})?E=7:L(n.current.canvas,m,{x:k,y:S})&&(E=8),d.current={type:B.Edit,data:{type:E,x1:m.clientX,y1:m.clientY,x2:m.clientX,y2:m.clientY},source:y},i.select(y)},[n,x,i]),R=l.useCallback(y=>{if(!f||!n.current||h.current)return;const{left:m,top:b}=n.current.canvas.getBoundingClientRect(),k=y.clientX-m,S=y.clientY-b;h.current={name:"Rectangle",type:B.Source,data:{size:a,color:o,x1:k,y1:S,x2:k,y2:S},editHistory:[],draw:lt,isHit:le}},[f,a,o,n]),C=l.useCallback(y=>{if(!(!f||!n.current)){if(d.current)d.current.data.x2=y.clientX,d.current.data.y2=y.clientY,t.top!==d.current?(d.current.source.editHistory.push(d.current),i.push(d.current)):i.set(t);else if(h.current){const{left:m,top:b}=n.current.canvas.getBoundingClientRect(),k=h.current.data;k.x2=y.clientX-m,k.y2=y.clientY-b,t.top!==h.current?i.push(h.current):i.set(t)}}},[f,n,t,i]),z=l.useCallback(()=>{f&&(h.current&&i.clearSelect(),h.current=null,d.current=null)},[f,i]);return oe(w),G(R),q(C),Q(z),g.jsx(X,{title:e.operation_rectangle_title,icon:"icon-rectangle",checked:f,onClick:v,option:g.jsx(re,{size:a,color:o,onSizeChange:p,onColorChange:u})})}const dt=[ut,at,ct,ot,nt,Ve,"|",We,Fe,"|",De,$e,Oe],ze=fe.createContext(null),ht=l.memo(function(){const{width:e,height:t}=H(),[i]=V(),[s,c]=l.useState(null),[r,n]=l.useState(null),a=l.useRef(null),p=l.useCallback(u=>{u.stopPropagation()},[]),o=l.useCallback(u=>{u.preventDefault(),u.stopPropagation()},[]);return l.useEffect(()=>{if(!i||!a.current)return;const u=a.current.getBoundingClientRect();let h=i.x+i.width-u.width,d=i.y+i.height+10;h<0&&(h=0),h>e-u.width&&(h=e-u.width),d>t-u.height&&(d=t-u.height-10),(!r||Math.abs(r.x-h)>1||Math.abs(r.y-d)>1)&&n({x:h,y:d}),(!s||Math.abs(s.x-u.x)>1||Math.abs(s.y-u.y)>1||Math.abs(s.width-u.width)>1||Math.abs(s.height-u.height)>1)&&c({x:u.x,y:u.y,width:u.width,height:u.height})}),i?g.jsx(ze.Provider,{value:s,children:g.jsx("div",{ref:a,className:"screenshots-operations",style:{visibility:r?"visible":"hidden",transform:`translate(${(r==null?void 0:r.x)??0}px, ${(r==null?void 0:r.y)??0}px)`},onDoubleClick:p,onContextMenu:o,children:g.jsx("div",{className:"screenshots-operations-buttons",children:dt.map((u,h)=>u==="|"?g.jsx("div",{className:"screenshots-operations-divider"},h):g.jsx(u,{},h))})})}):null});function ft(e){const[t,i]=l.useState(null);return l.useEffect(()=>{if(i(null),e==null)return;const s=document.createElement("img"),c=()=>i(s),r=()=>i(null);return s.addEventListener("load",c),s.addEventListener("error",r),s.src=e,()=>{s.removeEventListener("load",c),s.removeEventListener("error",r)}},[e]),t}function pt({url:e,width:t,height:i,lang:s,className:c,...r}){const n=ft(e),a=l.useRef(null),p=l.useRef({}),[o,u]=l.useState({index:-1,stack:[]}),[h,d]=l.useState(null),[f,x]=l.useState("move"),[v,w]=l.useState(void 0),R={url:e,width:t,height:i,image:n,lang:{...be,...s},emiterRef:p,canvasContextRef:a,history:o,bounds:h,cursor:f,operation:v},C=l.useCallback((S,...j)=>{const _=r[S];typeof _=="function"&&_(...j)},[r]),z={call:C,setHistory:u,setBounds:d,setCursor:x,setOperation:w},y=["screenshots"];c&&y.push(c);const m=()=>{p.current={},u({index:-1,stack:[]}),d(null),x("move"),w(void 0)},b=l.useCallback(async S=>{if(!(S.button!==0||!n))if(h&&a.current)ae({image:n,width:t,height:i,history:o,bounds:h}).then(j=>{C("onOk",j,h),m()});else{const j={x:0,y:0,width:t,height:i};ae({image:n,width:t,height:i,history:o,bounds:j}).then(_=>{C("onOk",_,j),m()})}},[n,o,h,t,i,C]),k=l.useCallback(S=>{S.button===2&&(S.preventDefault(),C("onCancel"),m())},[C]);return l.useLayoutEffect(()=>{m()},[e]),g.jsx(pe.Provider,{value:{store:R,dispatcher:z},children:g.jsxs("div",{className:y.join(" "),style:{width:t,height:i},onDoubleClick:b,onContextMenu:k,children:[g.jsx(Le,{}),g.jsx(Ae,{ref:a}),g.jsx(ht,{})]})})}var je={exports:{}};(function(e,t){(function(i,s){s()})(ee,function(){function i(o,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function s(o,u,h){var d=new XMLHttpRequest;d.open("GET",o),d.responseType="blob",d.onload=function(){p(d.response,u,h)},d.onerror=function(){console.error("could not download file")},d.send()}function c(o){var u=new XMLHttpRequest;u.open("HEAD",o,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function r(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(u)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ee=="object"&&ee.global===ee?ee:void 0,a=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),p=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(o,u,h){var d=n.URL||n.webkitURL,f=document.createElement("a");u=u||o.name||"download",f.download=u,f.rel="noopener",typeof o=="string"?(f.href=o,f.origin===location.origin?r(f):c(f.href)?s(o,u,h):r(f,f.target="_blank")):(f.href=d.createObjectURL(o),setTimeout(function(){d.revokeObjectURL(f.href)},4e4),setTimeout(function(){r(f)},0))}:"msSaveOrOpenBlob"in navigator?function(o,u,h){if(u=u||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(i(o,h),u);else if(c(o))s(o,u,h);else{var d=document.createElement("a");d.href=o,d.target="_blank",setTimeout(function(){r(d)})}}:function(o,u,h,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof o=="string")return s(o,u,h);var f=o.type==="application/octet-stream",x=/constructor/i.test(n.HTMLElement)||n.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||f&&x||a)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var z=w.result;z=v?z:z.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=z:location=z,d=null},w.readAsDataURL(o)}else{var R=n.URL||n.webkitURL,C=R.createObjectURL(o);d?d.location=C:location.href=C,d=null,setTimeout(function(){R.revokeObjectURL(C)},4e4)}});n.saveAs=p.saveAs=p,e.exports=p})})(je);var mt=je.exports;const xt="_shotScreen_1ej00_1",yt={shotScreen:xt},gt="/imgs/th.webp";function vt(){l.useRef(),l.useRef();const[e,t]=l.useState("");l.useEffect(()=>{i()},[]);async function i(){var a;if(window.electronAPI){const p=await((a=window.electronAPI)==null?void 0:a.invokeSsGetShotScreenImg());t(p||gt)}else navigator.mediaDevices.getDisplayMedia({video:!0}).then(p=>{const o=document.createElement("canvas");o.width=window.innerWidth,o.height=window.innerHeight;const u=document.createElement("video");u.srcObject=p,u.play(),u.addEventListener("loadedmetadata",()=>{o.getContext("2d").drawImage(u,0,0,o.width,o.height),t(o.toDataURL("image/png")),p.getTracks().forEach(d=>d.stop())})}).catch(p=>{console.error("Error accessing screen:",p)})}const s=l.useCallback((a,p)=>{const o=URL.createObjectURL(a);window.electronAPI?window.electronAPI.sendSsDownloadImg(o):mt.saveAs(o,o.split(`${location.origin}/`)[1]+".png")},[]),c=l.useCallback(()=>{},[]),r=l.useCallback((a,p)=>{const o=URL.createObjectURL(a);window.electronAPI?window.electronAPI.sendSsSaveImg(o):(n(o),window.open(`/viewImage.html?imgUrl=${encodeURIComponent(o)}`))},[]);async function n(a){const o=await(await fetch(a)).blob();await navigator.clipboard.write([new ClipboardItem({[o.type]:o})])}return ye.jsx("div",{className:yt.shotScreen,children:ye.jsx(pt,{url:e,width:window.innerWidth,height:window.innerHeight,onSave:s,onCancel:c,onOk:r})})}_e(vt);
