import{i as y,r,j as e}from"./main-63cdee0e.js";import{d as C,m as M}from"./style-acdf4931.js";import{f as P,b as E,c as T,d as V,e as A,a as F}from"./index.esm-d06886f9.js";import{B as i}from"./button-4029dead.js";import{C as L}from"./CameraOutlined-a6b412d8.js";const _="_recorderVideo_1wev8_1",D={recorderVideo:_},O=()=>{const m=r.useRef(),p=r.useRef(),s=r.useRef(),a=r.useRef([]),n=r.useRef(),[j,R]=r.useState(!1),[d,x]=r.useState(!1),[l,g]=r.useState(!1),u=r.useRef(!1),c=C.useStopwatch({autoStart:!1});function h(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{m.current.srcObject=t,p.current=t,n.current=t.getAudioTracks()[0],n.current.enabled=!0,s.current=new MediaRecorder(t),s.current.addEventListener("dataavailable",o=>{o.data.size>0&&a.current.push(o.data)}),s.current.addEventListener("stop",()=>{u.current&&N()}),s.current.start(),x(!0),c.start(),console.log("开始录像...")}).catch(t=>{console.error("无法获取媒体权限：",t)})}function v(){n.current&&(n.current.enabled=!1,g(!0),console.log("录像已静音"))}function b(){n.current&&(n.current.enabled=!0,g(!1),console.log("取消静音"))}function w(){!j&&s.current.state==="recording"&&(s.current.pause(),R(!0),c.pause(),console.log("录像已暂停"))}function B(){var t;d&&(s.current.stop(),(t=p.current)==null||t.getTracks().forEach(o=>o.stop()),x(!1),c.reset(null,!1),a.current=[],console.log("录像完成！"))}function I(){B(),u.current=!0}function N(){if(a.current.length>0){const t=new Blob(a.current,{type:"video/webm"}),o=URL.createObjectURL(t);if(window.electronAPI)window.electronAPI.sendRaDownloadRecord(o);else{const f=document.createElement("a");f.href=o,f.download=`pear-rec_${+new Date}.webm`,f.click(),a.current=[],u.current=!1}}}function S(){var t;(t=window.electronAPI)==null||t.sendRvShotScreen()}function k(){l?b():v()}return e.jsxs("div",{className:D.recorderVideo,children:[e.jsx("video",{className:"content",ref:m,playsInline:!0,autoPlay:!0}),e.jsxs("div",{className:"footer",children:[e.jsx(P,{className:`recordIcon ${d?"blink":""}`}),e.jsx(L,{rev:void 0,className:"recordIcon shotScreenBtn",onClick:S}),e.jsx("div",{className:"drgan"}),e.jsx(M,{seconds:c.seconds,minutes:c.minutes,hours:c.hours,className:"timer"}),e.jsx("div",{className:"recorderTools",children:u?d?e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"text",icon:e.jsx(E,{}),className:"toolbarIcon pauseBtn",title:"暂停",onClick:w}),e.jsx(i,{className:`toolbarIcon toggleMuteBtn ${l?"":"muted"}`,type:"text",onClick:k,icon:l?e.jsx(T,{}):e.jsx(V,{}),title:l?"打开声音":"禁音"}),e.jsx(i,{type:"text",icon:e.jsx(A,{}),className:"toolbarIcon stopBtn",title:"保存",onClick:I})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"toolbarTitle",children:"开始"}),e.jsx(i,{type:"text",icon:e.jsx(F,{}),className:"toolbarIcon playBtn",title:"开始",onClick:h})]}):e.jsx(i,{type:"text",loading:!0,children:"正在保存..."})})]})]})};y(O);
