import{r as s,j as e,i as T}from"./main-63cdee0e.js";import{d as _,m as A}from"./style-acdf4931.js";import{c as M,d as F,g as P,h as W,i as D,a as U,j as $}from"./index.esm-d06886f9.js";import{B as g}from"./button-4029dead.js";const G=s.forwardRef((d,b)=>{const[r,a]=s.useState(null),[o,f]=s.useState(null),[u,i]=s.useState(0),[x,v]=s.useState(0),[m,p]=s.useState(0),[c,w]=s.useState([]);s.useEffect(()=>{h()},[]),s.useEffect(()=>{R()},[c]),s.useImperativeHandle(b,()=>({play:B,pause:j,stop:k,reset:y}));function h(){const n=document.getElementById("canvas"),l=n.getContext("2d");f(l);const E=n.width;v(E);const L=n.height;i(L);const N=E/100-2;p(N);let H=[];for(let C=0;C<100;C++)H.push(10);w(H)}function I(){const t=u/2+u*Math.random()/2;c.shift(),c.push(t),R()}function R(){if(o){o.clearRect(0,0,x,u);for(let t=0,n=0;t<c.length;t++){const l=c[t];o.fillStyle="rgb(0,0,0)",o.fillRect(n,(u-l)/2,m,l),n+=m+2}}}function B(){const t=setInterval(()=>{I()},150);a(t)}function j(){r&&clearInterval(r)}function k(){r&&clearInterval(r),a(null),h()}function y(){r&&clearInterval(r),a(null),h()}return e.jsx("div",{className:"wavesurfer",children:e.jsx("canvas",{id:"canvas"})})}),z="_recordAudio_ka8fh_1",O="_web_ka8fh_53",q="_electron_ka8fh_60",S={recordAudio:z,web:O,electron:q},J=()=>{const d=s.useRef(),b=s.useRef(),r=s.useRef(),a=s.useRef([]),o=s.useRef(),[f,u]=s.useState(!1),[i,x]=s.useState(!1),[v,m]=s.useState(!1),p=s.useRef(!1),c=_.useStopwatch({autoStart:!1});function w(){navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{b.current=t,o.current=t.getAudioTracks()[0],o.current.enabled=!0,r.current=new MediaRecorder(t),r.current.addEventListener("dataavailable",n=>{n.data.size>0&&a.current.push(n.data)}),r.current.addEventListener("stop",()=>{p.current&&y()}),r.current.start(),x(!0),d.current.play(),c.start(),console.log("开始录音...")}).catch(t=>{console.error("无法获取麦克风权限：",t)})}function h(){o.current&&(o.current.enabled=!1,m(!0),console.log("录音已静音"))}function I(){o.current&&(o.current.enabled=!0,m(!1),console.log("取消静音"))}function R(){!f&&r.current.state==="recording"&&(r.current.pause(),u(!0),d.current.pause(),c.pause(),console.log("录音已暂停"))}function B(){f&&r.current.state==="paused"&&(r.current.resume(),u(!1),d.current.play(),c.start(),console.log("恢复录音..."))}function j(){var t;i&&(r.current.stop(),(t=b.current)==null||t.getTracks().forEach(n=>n.stop()),x(!1),c.reset(null,!1),d.current.reset(),a.current=[],console.log("录音完成！"))}function k(){j(),p.current=!0}function y(){if(a.current.length>0){const t=new Blob(a.current,{type:"audio/webm"}),n=URL.createObjectURL(t);if(window.electronAPI)window.electronAPI.sendRaDownloadRecord(n);else{const l=document.createElement("a");l.href=n,l.download=`pear-rec_${+new Date}.webm`,l.click(),a.current=[],p.current=!1}}}return e.jsxs("div",{className:`${S.recordAudio} ${window.isElectron?S.electron:S.web}`,children:[e.jsx("span",{className:"micBtn",children:v?e.jsx(F,{title:"打开声音",onClick:I}):e.jsx(M,{title:"静音",onClick:h})}),e.jsx("div",{className:"timer",children:e.jsx(A,{seconds:c.seconds,minutes:c.minutes,hours:c.hours})}),e.jsx(G,{ref:d}),e.jsxs("div",{className:"recorderTools",children:[e.jsx(g,{shape:"circle",icon:e.jsx(P,{}),className:"toolbarIcon resetBtn",title:"删除",disabled:!i,onClick:j}),i?e.jsx(g,{danger:!0,type:"primary",shape:"circle",icon:e.jsx(W,{}),className:"toolbarIcon stopBtn",title:"保存",disabled:!i,onClick:k}):e.jsx(g,{danger:!0,type:"primary",shape:"circle",icon:e.jsx(D,{}),className:"toolbarIcon playBtn",title:"开始",onClick:w}),f?e.jsx(g,{type:"primary",shape:"circle",icon:e.jsx(U,{}),className:"toolbarIcon resumeBtn",title:"继续",disabled:!i,onClick:B}):e.jsx(g,{type:"primary",shape:"circle",icon:e.jsx($,{}),className:"toolbarIcon pauseBtn",title:"暂停",disabled:!i,onClick:R})]})]})};T(J);
